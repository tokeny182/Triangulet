<!DOCTYPE html>
<html>

  <head>
    <title>Posts | Triangulet</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" crossorigin="anonymous" href="https://ac.blooket.com/dashclassic/assets/index-BQ9cjwWZ.css">
    <link rel="icon" type="image/x-icon" href="https://i.ibb.co/5GBHSTB/Triangulet-Game-Logo.png">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body>
    <div class="styles__background___2J-JA-camelCase">
      <div class="styles__blooksBackground___3oQ7Y-camelCase" style="background-image: url(&quot;https://i.ibb.co/d7GK1cC/background.png&quot;);  animation: animatedBackground 9s linear infinite;
                                                                     -moz-animation: animatedBackground 9s linear infinite;
                                                                     -webkit-animation: animatedBackground 9s linear infinite;
                                                                     -ms-animation: animatedBackground 9s linear infinite;
                                                                     -o-animation: animatedBackground 9s linear infinite;"></div>
    </div>
    <div class="styles__topRightRow___dQvxc-camelCase">
    <div class="styles__profileContainer___CSuIE-camelCase" role="button" tabindex="0">
    <div class="styles__profileRow___cJa4E-camelCase">
      <div style="position: relative" class="styles__blookContainer___36LK2-camelCase styles__profileBlook___37mfP-camelCase">
        <img src="https://i.ibb.co/5GBHSTB/Triangulet-Game-Logo.png" id="pfpimg" draggable="false" class="styles__blook___1R6So-camelCase">
      </div>
      <span style="color: #ffffff" id="usernamedrop">user</span>
    </div>
    <i class="fas fa-angle-down styles__profileDropdownIcon___3iLIX-camelCase" aria-hidden="true"></i>
    <div class="styles__profileDropdownMenu___2jUAA-camelCase">
      <a id="logout-link" class="styles__profileDropdownOption___ljZXD-camelCase" href="/login">
  <i class="fas fa-sign-out-alt styles__profileDropdownOptionIcon___15VKX-camelCase" aria-hidden="true"></i>
  Logout
</a>
    </div>
  </div>
</div>
    <div class="styles__sidebar___1XqWi-camelCase">
      <a href="/" id="big-name" class="styles__blooketText___1pMBG-camelCase">Triangulet</a>
      <a class="_button_552gk_1 _bigButton_l4eyq_22" href="/play">
    <div class="_shadow_552gk_11"></div>
    <div class="_edge_552gk_23" style="background-color: #4a7233"></div>
    <div class="_front_552gk_33" style="background-color: #53b721">
        <div class="_bigButtonInside_l4eyq_26"><i class="fas fa-play _bigIcon_l4eyq_39"></i>Play</div>
    </div>
</a>
      <div class="nothin">
        <a class="styles__pageButton___1wFuu-camelCase" href="/market">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-store" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Market</div>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" href="/trians">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-suitcase" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Trians</div>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" href="/leaderboard">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-trophy" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Leaderboard</div>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" href="/chat">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-comment" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Chat</div>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" href="/posts">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-file" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Posts</div>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" id="newsbutton" style="cursor: pointer;">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-newspaper" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">News</div>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" href="/auction">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-building-columns" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Auction</div>
          <a class="styles__pageButton___1wFuu-camelCase" href="/trianai"><i class="styles__pageIcon___3OSy9-camelCase fas fa-robot" aria-hidden="true"></i>
            <div class="styles__pageText___1eo7q-camelCase">TrianAI</div>
          </a>
        </a>
        <a class="styles__pageButton___1wFuu-camelCase" href="/staff">
          <i class="styles__pageIcon___3OSy9-camelCase fas fa-terminal" aria-hidden="true"></i>
          <div class="styles__pageText___1eo7q-camelCase">Staff</div>
        </a>
      </div>
      <div class="styles__bottomRow___3OozA-camelCase">
        <a data-tip="Credits" class="styles__smallButton___sQuq8-camelCase" href="/credits" currentitem="false"><i class="styles__bottomIcon___3Fswk-camelCase fas fa-address-book" aria-hidden="true"></i></a>
        <a data-tip="Settings" class="styles__smallButton___sQuq8-camelCase" href="/settings" currentitem="false"><i class="styles__bottomIcon___3Fswk-camelCase fas fa-cogs" aria-hidden="true"></i></a>
        <a data-tip="Stats" class="styles__smallButton___sQuq8-camelCase" href="/stats" currentitem="false"><i class="styles__bottomIcon___3Fswk-camelCase fas fa-user" aria-hidden="true"></i></a>
        <a data-tip="Stats" class="styles__smallButton___sQuq8-camelCase" href="https://discord.gg/FcYy4uHUws" currentitem="false"><i class="styles__bottomIcon___3Fswk-camelCase fab fa-discord" aria-hidden="true"></i></a>
      </div>
    </div>

    <div id="explaination" class="explaination">Read Stories, Share Info, and Have Fun!</div>
    <a data-tip="Create" class="styles__smallButton___sQuq8-camelCase" href="/create" currentitem="false"><i class="styles__bottomIcon___3FswG-camelCase fas fa-plus" aria-hidden="true"></i></a>
<script src="/news.js"></script> 
    <script src="/themes.js"></script>
    <script src="/all.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDV9tQXgzqxUayhvc384tTLOwy0QOEZVcU",
    authDomain: "chat-e6c93.firebaseapp.com",
    databaseURL: "https://chat-e6c93-default-rtdb.firebaseio.com",
    projectId: "chat-e6c93",
    storageBucket: "chat-e6c93.appspot.com",
    messagingSenderId: "131547791719",
    appId: "1:131547791719:web:2f567033f028810345afc2",
    measurementId: "G-VY49LNJJLG"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function escapeHtml(text) {
    const element = document.createElement('div');
    element.innerText = text || '';
    return element.innerHTML;
  }

  document.addEventListener("DOMContentLoaded", () => {
    const container = document.querySelector(".explaination");
    const username = localStorage.getItem("triangulet_username") || "user";

    const userDrop = document.getElementById("usernamedrop");
    if (userDrop) userDrop.textContent = escapeHtml(username);

    if (!container) return;

    const postsRef = db.ref('triangulet-posts');

    postsRef.on('value', snapshot => {
      const posts = snapshot.val();
      if (!posts) return;

      const nearBottom = Math.abs(container.scrollHeight - container.scrollTop - container.clientHeight) < 100;
      const oldScrollTop = container.scrollTop;
      const oldPosts = container.querySelectorAll('.postbackground');
      oldPosts.forEach(post => post.remove());

      Object.entries(posts).reverse().forEach(([postId, post]) => {
        const safeTitle = escapeHtml(post.title);
        const safeBody = escapeHtml(post.body);
        const safeUser = escapeHtml(post.user);

        const likesArray = post.likes || [];
        const likecount = likesArray.length;
        const likedByUser = likesArray.includes(username);
        const colorheart = likedByUser ? "red" : "white";

        const postDiv = document.createElement("div");
        postDiv.classList.add("postbackground");
        postDiv.style.color = "#fff";
        postDiv.id = postId;

        postDiv.innerHTML = `
          <h1>${safeTitle}</h1>
          <text class="usertextpost">
            Author: <a style="color:#CAE4F1" href="/stats?id=${encodeURIComponent(post.user)}">${safeUser}</a>
          </text><br>
          <i id="${postId}1" style="color: ${colorheart}; font-size:25px; cursor:pointer;" onclick="like('${postId}')" class="fas fa-heart"></i>
          <text class="${postId}" style="font-size:25px"> ${likecount}</text>
          <p>${safeBody}</p>
        `;

        container.appendChild(postDiv);
      });

      if (nearBottom) {
        container.scrollTop = container.scrollHeight;
      } else {
        container.scrollTop = oldScrollTop;
      }
    });
  });

  function like(postId) {
    const heart = document.getElementById(`${postId}1`);
    const countText = document.querySelector(`.${postId}`);
    const username = localStorage.getItem("triangulet_username") || "user";

    if (!heart || !countText) return;

    const postLikesRef = firebase.database().ref(`triangulet-posts/${postId}/likes`);

    postLikesRef.once('value').then(snapshot => {
      let likes = snapshot.val() || [];

      if (likes.includes(username)) {
        likes = likes.filter(name => name !== username);
        heart.style.color = "white";
      } else {
        likes.push(username);
        heart.style.color = "red";
      }

      postLikesRef.set(likes);
      countText.innerText = ` ${likes.length}`;
    }).catch(err => {
      console.error("Failed to update likes:", err);
    });
  }
</script>










  </body>

</html>
